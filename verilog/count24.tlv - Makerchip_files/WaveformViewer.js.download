(function(){define("WaveformViewer",function(require,exports,module){var $,Logging,ModelViewSync,Pane,Promise,Utils,WaveData,WaveformGenerator,WaveformViewer;$=require("jquery");Logging=require("Logging");Utils=require("Utils");ModelViewSync=require("ModelViewSync");Pane=require("Pane");Promise=require("bluebird");WaveformGenerator=require("WaveformViewer/WaveformGenerator");WaveData=require("VCD");WaveformViewer=(function(){var MAX_STARTING_SIGNALS,MAX_STARTING_TIME;class WaveformViewer extends Pane{init(name,ide,project,tabbedview){return this.initPane("WaveformViewer",name,ide,project,tabbedview).then(()=>{var btn,btns,camelCase,element,i,len;this.enableTimestamp();this.le=[];element=this.getContainer();this.project.on("vcd",(wd)=>{this.setStatus("success");return this.updateWaveData(wd);});this.project.on("verilator/done",(data)=>{if(data.success==="success"){return this.setStatus("success");}});element.on("click",".wave, .wavescope",(e)=>{var parentOffset,relX;parentOffset=this.getContainer().offset();relX=e.pageX-parentOffset.left;return this.wg.setLineByPosition(relX);});element.on("click",".name, .value, .waveName, .scope",(e)=>{var le;if($(e.target).is(".waveExpand, .waveCollapse")){return;}
this.le.push(le=$(e.target).parent().attr("logical_entity").replace(/\[[0-9]+\]/g,""));if($(e.target).parent().find(".scope").length){return this.highlightBehHier(le,e.ctrlKey);}else{return this.highlightLogicalElement(le,e.ctrlKey);}});element.on("click",".ruler",(e)=>{var parentOffset,relX;parentOffset=this.getContainer().offset();relX=e.pageX-parentOffset.left;if(relX>this.wg.textRegionWidth){return this.wg.setLineByPosition(relX);}});btns=["zoom-in","zoom-out","zoom-full","move-left","move-right"];camelCase=function(str){return str.replace(/-([a-zA-Z])/g,function(g){return g[1].toUpperCase();});};for(i=0,len=btns.length;i<len;i++){btn=btns[i];((btn)=>{var header;header=Utils.$one("#mc-waveform-header",this.paneEl);return header.on("click",`[data-waveformviewer-button-${btn}]`,(e)=>{if(this.wg){return this.toHTML(this.wg[camelCase(btn)]());}});})(btn);}
element.on("click",".waveCollapse",(e)=>{this.wg.collapseScope($(e.target).parent().attr("logical_instance"));return this.toHTML(this.wg.generateWave(this.wg.currentStart,this.wg.currentEnd));});element.on("click",".waveExpand",(e)=>{this.wg.expandScope($(e.target).parent().attr("logical_instance"));return this.toHTML(this.wg.generateWave(this.wg.currentStart,this.wg.currentEnd));});return this;});}
getContainer(){return Utils.$one("[data-WaveformViewer-container]",this.paneEl);}
getPath(){return this.path;}
resize(force=false){var width;width=this.getContainer().width();if(this.wg&&(force||(width!==this.wg.windowWidth))){return this.toHTML(this.wg.generateWave(this.wg.currentStart,this.wg.currentEnd,width));}}
compiler(_compiler){this._compiler=_compiler;this._compiler.on("vcd",(wd)=>{return this.updateWaveData(wd);});this._compiler.on("sandpiper/done",(data)=>{if(data.success==="success"){return;}
return this.setStatus(data.timeout?"timeout":"fail");});this._compiler.on("verilator/done",(data)=>{return this.setStatus(data.success==="success"?"success":data.timeout?"timeout":"fail");});return this._compiler.on("newcompile",()=>{return this.setStatus("working");});}
toHTML(out){var date;this.getContainer().html(out);this.rendered=true;if((this.wg.lineCycle!=null)&&!isNaN(this.wg.lineCycle)){this.wg.setLineByCycle(this.wg.lineCycle);}
if((this.project.vizPane!=null)&&this.project.vizPane.cyc!==null){this.wg.setVizCursorCycle(this.project.vizPane.cyc);}
if((this.le!=null)&&this.le.length>0){this._highlightLogicalElement(this.le);}
return date=new Date();}
updateWaveData(wd){this.wg=new WaveformGenerator(this,wd,this.getPath());if(wd.numTlvSignals>MAX_STARTING_SIGNALS){this.wg.collapseAllScopes();}else{this.wg.collapseScope("SV");}
if(wd.lastCycle>MAX_STARTING_TIME){this.wg.currentEnd=MAX_STARTING_TIME;}
this.wg.lineCycle=0;if(this.active){return this.resize();}}
_highlightLogicalElement(le){var ele,i,len,results;if(!(le instanceof Array)){this.le.push(le);le=this.le;}
results=[];for(i=0,len=le.length;i<len;i++){ele=le[i];results.push($(`#${this.getPath()} [logical_entity='`+ele+"']").find(".name, .waveName, .wave rect, .value").addClass("highlight"));}
return results;}
_highlightBehHier(le){return $(`#${this.getPath()} [logical_entity*='`+le+"']").find(".name, .waveName, .wave rect, .value").addClass("highlight");}
_unhighlightLogicalElements(){$(`#${this.getPath()} .highlight`).removeClass("highlight");return this.le=[];}};WaveformViewer.prototype.public=null;WaveformViewer.prototype.wg=null;WaveformViewer.prototype.rendered=false;WaveformViewer.prototype._compiler=null;WaveformViewer.prototype._tabbedview=null;WaveformViewer.prototype.le=null;WaveformViewer.prototype.hidden=null;MAX_STARTING_SIGNALS=50;MAX_STARTING_TIME=100;return WaveformViewer;}).call(this);Utils.extend(WaveformViewer,module.config(),true,true);Utils.extend(WaveformViewer,ModelViewSync,{_highlightLogicalElement:1,_unhighlightLogicalElements:1,_highlightBehHier:1});return WaveformViewer;});}).call(this);